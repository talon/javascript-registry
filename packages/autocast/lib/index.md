```js
const { resolve } = require("path");
const { readdir, readFile } = require("fs");
const markov = require("markov");
const _ = require("highland");
const { sample } = require("lodash");
```

The podcast script is built with a Markov Chain.

```js
const settings = require("../settings.json");
const chain = markov(settings.order);
```

We feed the chain text files from the `settings.sources` folder.
Any folder specified in the `settings.use` array will be merged into the chain.

```js
chain.seed(
  _(settings.use)
    .map(source => `${settings.sources}/${source}`)
    .map(resolve)
    .flatMap(source =>
      _([source])
        .flatMap(_.wrapCallback(readdir))
        .flatten()
        .map(file => `${source}/${file}`)
    )
    .map(_.wrapCallback(readFile))
    .parallel(settings.parallel)
    .map(buffer => buffer.toString("utf8"))
    .map(content => content.replace(/\n/g, "").replace(/\.\s/g, "\n"))
    .toNodeStream(),
```

Then we randonly select from an array of hosts specified by `settings.hosts`
assigning them a line generated by the chain,
ultimately creating a script `settings.length` lines long.

```js
  () =>
    [...Array(settings.length)].forEach(() =>
      console.log(
        `${sample(settings.hosts)}:`,
        chain.respond(chain.pick()).join(" ") + "\n"
      )
    )
);
```
