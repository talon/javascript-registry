# @talon/apollo-graph

## Occam's Razor

Apollo Server requires four options `{typeDefs, context, dataSources, resolvers}`.

A resolver is a connection (edge) from a GraphQL query to the source of it's data. This abstracts _how data is retrieved_.

Apollo Server calls it's opinion on how to retrieve data a [data source](https://www.npmjs.com/package/apollo-datasource). 
Seeing as this is one of the four Apollo Server options it's a very strong opinion.

If resolvers ask "how?" and data sources answer then it stands to reason that most, if not all, data sources
can derive their own resolvers as conceptually they're an implementation there of.

Let's look at how this plays out with [apollo-datasource-rest](https://www.npmjs.com/package/apollo-datasource-rest)

Assuming we have a GraphQL typeDef that declares `Account` and a `Query` of `account`

```js
class Mastodon extends RESTDataSource {
  get baseUrl() {
    return "mastodon.technology"
  }

  accounts(params) {
    this.get(`/api/v1/${params.id}`)
  }
}

const server = new ApolloServer({
  dataSources: {
    mastodon: new Mastodon()
  }
})
```

This will create `context.dataSources.mastodon.account` which can be consumed by the resolver as

```js
const server = new ApolloServer({
  dataSources: {
    mastodon: new Mastodon()
  },
  resolvers: {
    Query: {
      account: ({parent, params, context}) => 
        context.dataSources.mastodon.account(params)
    }
  }
})

```

# Occam's Razor, applied

In this implementation a `Node` is a composable abstraction of the four Apollo options.
They look like this:

```js
Node.REST("mastodon", {
  instance: async () => "mastodon.technology",
  authorization: async () => ""
}, {
  get: {
    account: "/api/v1/accounts/:id"
  }
})
```

**Parameters**

| name        | Description
|-------------|------------
| `namespace` | used internally to organize the final Apollo object
| `context`   | keys will be resolved as values on the final Apollo context under the `namespace`. Ex. `mastodon.instance`
| `config`    | the final Apollo `resolvers` are built from this. Varies per Node type.

One or more nodes can be composed with `Graph.fromNodes` and served by Apollo Server.

Node implementations handle the dirty work of applying the razor, consumers enjoy the benefits.

# API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

- [fromNodes](#fromnodes)
  - [Parameters](#parameters)
- [RESTEdge](#restedge)
  - [Parameters](#parameters-1)
  - [Examples](#examples)

## fromNodes

- **See: RESTEdge**

build a Graph.fromNodes

nodes are objects of the shape
{ typeDefs, context, dataSources }

where `dataSources` is an array of `Edges`

### Parameters

- `nodes` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)**

Returns **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)**

## RESTEdge

**Extends RESTDataSource**

Declaritively map GraphQL queries to REST endpoints

### Parameters

- `$0` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)**
  - `$0.resource`
  - `$0.name`
  - `$0.instance`
  - `$0.authorization`
- `bind` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** map GraphQL queries to REST routes
- `options` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)**

### Examples

```javascript
new RESTEdge(
  {
    name: "mastodon.accounts",
    resource: "/api/v1/accounts",
    instance: "mastodon.instance",
    authorization: "mastodon.authorization"
  },
  {
    get: {
      account: "/:id",
      followers: "/:id/followers",
      following: "/:id/followers",
      relationships: "/:id/relationships",
      search: "/:id/search",
      statuses: "/:id/statuses",
      verify_credentials: "/:id/verify_credentials"
    },
    post: {
      accounts: "/:id/",
      follow: "/:id/follow",
      unfollow: "/:id/unfollow"
    },
    patch: {
      update_credentials: "update_credentials"
    }
  }
);
```
